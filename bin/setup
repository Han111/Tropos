#!/usr/bin/env bash

set -e

if [[ -n $CARTHAGE_LOG_PATH ]]; then
  carthage_log_opts=(--log-path "$CARTHAGE_LOG_PATH")
fi

brew bundle
gem install xcpretty
carthage bootstrap --platform iOS --cache-builds --no-use-binaries "${carthage_log_opts[@]}"

tropos_secrets="Config/Secrets.h"
example_secrets="Config/Secrets-Example.h"

if [ ! -f "${tropos_secrets}" ]; then
  cp "${example_secrets}" "${tropos_secrets}"
  echo ""
  echo "--------------------------------------------------------------------------------"
  echo "Created ${tropos_secrets}. Please add your keys to it."
  echo "--------------------------------------------------------------------------------"
fi
